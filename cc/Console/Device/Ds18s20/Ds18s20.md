# DS18S20

The DS18S20 circuit is a digital thermometer that provides 9-bit Celsius temperature measurements. It operates as slave device on a [1-Wire Bus](1wire.md).

Highlites:

* Measures temperatures from -55°C to +125°C at a 9-bit resolution
* Accuracy of ±0.5°C from -10°C to +85°C
* Alarm function with upper and lower trigger points
* Optional Parasite Power Mode that requires only 2 pins for operation
* data rate ??

Please refert to the [datasheet](http://datasheets.maximintegrated.com/en/ds/DS18S20.pdf) for details.

## Power Supply

The DS18S20 can be powered by an external supply on the VDD pin, or it can operate in “parasite power” mode, which allows the DS18S20 to be connected on only 2 pins. In parasite power mode external switching is required for the data line and not all operations are supported. For the remainder of document, it is assumed, the device is connected to an external power supply.

## ROM Family Code

The least significant 8 bits of the ROM code contain the DS18S20’s 1-Wire family code which is 10h.

## Operation

### Measuring

The core functionality of the DS18S20 is its direct-to-digital temperature sensor. The temperature sensor output has 9-bit resolution, which corresponds to 0.5°C steps. The DS18S20 powers-up in a low-power idle state; to initiate a temperature measurement and A-to-D conversion, the master must issue a Convert T [44h] command.

Following the conversion, the resulting thermal data is stored in the 2-byte temperature register in the scratch-pad memory and the DS18S20 returns to its idle state.

If the DS18S20 is powered by an external supply, the master can issue “read-time slots” after the Convert T command and the DS18S20 will respond by transmitting 0 while the temperature conversion is in progress and 1 when the conversion is done.

The DS18S20 output data is calibrated in degrees centigrade. The temperature data is stored as a 16-bit sign-extended two’s complement number in the temperature register (see Figure 4). The sign bits (S) indicate if the temperature is positive or negative: for positive numbers S = 0 and for negative numbers S = 1. 

The table below gives examples of digital output data and the corresponding temperature reading.

TEMPERATURE (°C) | DIGITAL OUTPUT (BINARY) | DIGITAL OUTPUT (HEX)
---: | :--- | :---
+85.0 | 0000 0000 1010 1010 | 00AAh
+25.0 | 0000 0000 0011 0010 | 0032h
+0.5 | 0000 0000 0000 0001 | 0001h
0 | 0000 0000 0000 0000 | 0000h
-0.5 | 1111 1111 1111 1111 | FFFFh
-25.0 | 1111 1111 1100 1110 | FFCEh
-55.0 | 1111 1111 1001 0010 | FF92h

Resolutions greater than 9 bits can be calculated using the data from the temperature, COUNT REMAIN and COUNT PER °C registers in the scratchpad.

After reading the scratchpad, the TEMP_READ value is obtained by truncating the 0.5°C bit (bit 0) from the temperature data. The extended resolution temperature can then be calculated using the following equation:

TEMPERATURE = (TEMP_READ - 0.25) + (COUNT_PER_C - COUNT_REMAIN) / COUNT_PER_C

### Alarm

After the DS18S20 performs a temperature conversion, the temperature value is compared to the user-defined two’s complement alarm trigger values stored in the 1-byte TH and TL registers.

The TH and TL are 8-bit registers. They hold the threshold in °C which is half of the resolution of the temperature register (that has a resolution of 0.5 °C).

Bits 8 through 1 of the temperature register are used in the TH and TL comparison. If the measured temperature is lower than or equal to TL or higher than TH, an alarm condition exists and an alarm flag is set inside the DS18S20. This flag is updated after every temperature measurement; therefore, if the alarm condition goes away, the flag will be turned off after the next temperature conversion.

The master device can check the alarm flag status of all DS18S20s on the bus by issuing an Alarm Search [ECh] command. Any DS18S20s with a set alarm flag will respond to the command, so the master can determine exactly which DS18S20s have experienced an alarm condition. If an alarm condition exists and the TH or TL settings have changed, another temperature conversion should be done to validate the alarm condition.

## Memory

The memory consists of an SRAM scratch-pad:

Byte | Access | Name | Notes
---: | :--- | :--- | :---
 0 | RO | Temperature LSB | AAh after power-on
 1 | RO | Temperature MSB | 00h after power-on
 2 | RW | High Threshold Alarm (TH) | loaded from EEPROM
 3 | RW | Low Threshold Alarm (TL) | loaded from EEPROM
 4 | RO | Reserved | always FFh
 5 | RO | Reserved | always FFh
 6 | ?? | Count Remain | 0Ch 
 7 | RO | Count Per °C | always 10h
 8 | RO | CRC for bytes 0 through 7

The power-on reset value of the temperature register is +85°C which is 00AAh.

If the DS18S20 alarm function is not used, the Alarm registers can serve as general-purpose memory.

Bytes 6 and 7 contain the COUNT REMAIN and COUNT PER °C registers, which can be used to calculate extended resolution results as explained in the Operation—Measuring Temperature section.

The scratchpad can be read (using the Read Scratchpad [BEh] command). When reading the scratchpad, data is transferred over the 1-Wire bus starting with the least significant bit of byte 0.

Data is written to bytes 2 and 3 of the scratchpad using the Write Scratchpad [4Eh] command; the data must be transmitted to the DS18S20 starting with the least significant bit of byte 2. To verify data integrity, the scratchpad can be read back after the data is written.

### EEPROM

There is nonvolatile EEPROM backup storage for the Alarm registers. Data in the EEPROM registers is retained when the device is powered down; at power-up the EEPROM data is reloaded into the corresponding scratchpad locations.

To transfer the Alarm data from the scratchpad to EEPROM, the master must issue the Copy Scratchpad [48h] command. Data can also be reloaded from EEPROM to the scratch-pad at any time using the Recall E 2 [B8h] command.

The master can issue “read-time slots” (see the 1-Wire Bus System section) following the Recall E 2 command and the DS18S20 will indicate the status of the recall by transmitting 0 while the recall is in progress and 1 when the recall is done.

## Function Commands

After the bus master has used a ROM command to address the DS18S20 with which it wishes to communicate, the master can issue one of the DS18S20 function commands. These commands allow the master to write to and read from the DS18S20’s scratchpad memory, initiate temperature conversions and determine the power supply mode.

| # | Command | Description 
---: | :--- | :--- 
44 | Convert | Initiate temperature conversion.
4E | Write Scratchpad | Write TH and TL registers to scratchpad.
48 | Copy Scratchpad | Save TH and TL registers from the scratchpad to EEPROM.
B8 | Recall | Restore TH and TL registers from EEPROM to scratchpad.
B4 | Read Power Supply | Read power supply mode.
BE | Read Scratchpad | Read the entire scratchpad including the CRC byte.

### Convert [44h]

This command initiates a single temperature conversion. Following the conversion, the resulting thermal data is stored in the 2-byte temperature register in the scratch-pad memory and the DS18S20 returns to its low-power idle state.

The master can issue read-time slots after the Convert command and the DS18S20 will respond by transmitting 0 while the temperature conversion is in progress and 1 when the conversion is done. 

### Write Scratchpad [4Eh]

This command allows the master to write 2 bytes of data to the DS18S20’s scratchpad. The first byte is written into the TH register, and the second byte is written into the TL register. Data must be transmitted least significant bit first. Both bytes MUST be written before the master issues a reset, or the data may be corrupted.

### Read Scratchpad [BEh]

This command allows the master to read the contents of the scratchpad. The data transfer starts with the least significant bit of byte 0 and continues through the scratchpad until the 9th byte is read. The master may issue a reset to terminate reading at any time if only part of the scratchpad data is needed.

Note that the Read Scratchpad command can follow the Skip ROM command only if there is a single slave device on the bus. In this case, time is saved by allowing the master to read from the slave without sending the device’s 64-bit ROM code. A Skip ROM command followed by a Read Scratchpad command will cause a data collision on the bus if there is more than one slave since multiple devices will attempt to transmit data simultaneously.

### Copy Scratchpad [48h]

This command copies the contents of the scratchpad TH and TL registers to EEPROM.

The master can issue read-time slots after the Convert command and the DS18S20 will respond by transmitting 0 while the temperature conversion is in progress and 1 when the conversion is done. 

### Recall [B8h]

This command recalls the alarm trigger values (TH and TL) from EEPROM and places the data in bytes 2 and
3, respectively, in the scratchpad memory. The master device can issue read-time slots following the Recall command and the DS18S20 will indicate the status of the recall by transmitting 0 while the recall is in progress and 1 when the recall is done. The recall operation happens automatically at power-up, so valid data is available in the scratchpad as soon as power is applied to the device.

### Read Power Supply [B4h]

The master device issues this command followed by a read-time slot to determine if any DS18S20s on the bus are using parasite power. During the read-time slot, parasite powered DS18S20s will pull the bus low, and externally powered DS18S20s will let the bus remain high.

